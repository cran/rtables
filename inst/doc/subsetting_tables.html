<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Gabriel Becker and Adrian Waddell" />

<meta name="date" content="2023-08-30" />

<title>Subsetting and Manipulating Table Contents</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Subsetting and Manipulating Table
Contents</h1>
<h4 class="author">Gabriel Becker and Adrian Waddell</h4>
<h4 class="date">2023-08-30</h4>



<style type="text/css">
.reveal .r code {
white-space: pre;
}
</style>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p><code>TableTree</code> objects are based on a tree data structure as
the name indicates. The package is written such that the user does not
need to walk trees for many basic table manipulations. Walking trees
will still be necessary for certain manipulation and will be the subject
of a different vignette.</p>
<p>In this vignette we show some methods to subset tables and to extract
cell values.</p>
<p>We will use the following table for illustrative purposes:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(rtables)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>lyt <span class="ot">&lt;-</span> <span class="fu">basic_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="fu">split_cols_by</span>(<span class="st">&quot;ARM&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="fu">split_rows_by</span>(<span class="st">&quot;SEX&quot;</span>, <span class="at">split_fun =</span> drop_split_levels) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="fu">analyze</span>(<span class="fu">c</span>(<span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;STRATA1&quot;</span>))</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">build_table</span>(lyt, ex_adsl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SEX <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>)))</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>tbl</span></code></pre></div>
<pre><code>#             A: Drug X   B: Placebo   C: Combination
# ———————————————————————————————————————————————————
# F                                                  
#   AGE                                              
#     Mean      32.76       34.12          35.20     
#   STRATA1                                          
#     A          21           24             18      
#     B          25           27             21      
#     C          33           26             27      
# M                                                  
#   AGE                                              
#     Mean      35.57       37.44          35.38     
#   STRATA1                                          
#     A          16           19             20      
#     B          21           17             21      
#     C          14           19             19</code></pre>
</div>
<div id="traditional-subsetting-and-modification-with" class="section level2">
<h2>Traditional Subsetting and modification with <code>[</code></h2>
<p>The <code>[</code> and <code>[&lt;-</code> accessor functions operate
largely the same as their <code>data.frame</code> cousins:</p>
<ul>
<li><code>[</code> and <code>[&lt;-</code> both treat Tables as
rectangular objects (rather than trees)
<ul>
<li>In particular this means label rows are treated as rows with empty
cell values, rather than rows without cells</li>
</ul></li>
<li><code>[</code> accepts both column and row absolute position, and
missing arguments mean “all indexes in that dimension”
<ul>
<li>multiple values can be specified in both row and column
position</li>
<li>negative numeric positions are supported, though like
<code>[.data.frame</code> they cannot be mixed with positive ones</li>
</ul></li>
<li><code>[</code> always returns the same class as the object being
subset unless <code>drop = TRUE</code></li>
<li><code>[ , drop = TRUE</code> returns the raw (possibly
multi-element) value associated with the cell.</li>
</ul>
<p><strong>Known Differences from <code>[.data.frame</code></strong> -
absolute position cannot currently be used to reorder columns or rows.
Note in general the result of such an ordering is unlikely to be
structurally valid. To change the order of values, please read <a href="https://insightsengineering.github.io/rtables/main/articles/sorting_pruning.html">sorting
and pruning</a> vignette or relevant function
(<code>sort_at_path()</code>). - <code>character</code> indices are
treated as paths, not vectors of names in both <code>[</code> and
<code>[&lt;-</code></p>
<p>The <code>[</code> accessor function always returns an
<code>TableTree</code> object if <code>drop=TRUE</code> is not set. The
first argument are the row indices and the second argument the column
indices. Alternatively logical subsetting can be used. The indices are
based on visible rows and not on the tree structure. So:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>tbl[<span class="dv">1</span>, <span class="dv">1</span>]</span></code></pre></div>
<pre><code>#     A: Drug X
# —————————————
# F</code></pre>
<p>is a table with an empty cell because the first row is a label row.
We need to access a cell with actual cell data:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>tbl[<span class="dv">3</span>, <span class="dv">1</span>]</span></code></pre></div>
<pre><code>#        A: Drug X
# ————————————————
# Mean     32.76</code></pre>
<p>To retrieve the value, we use <code>drop = TRUE</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>tbl[<span class="dv">3</span>, <span class="dv">1</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]</span></code></pre></div>
<pre><code># [1] 32.75949</code></pre>
<p>One can access multiple rows and columns:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>tbl[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>#            A: Drug X   B: Placebo
# —————————————————————————————————
# F                                
#   AGE                            
#     Mean     32.76       34.12</code></pre>
<p>Note that we do not repeat label rows for descending children,
e.g.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>tbl[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, ]</span></code></pre></div>
<pre><code>#           A: Drug X   B: Placebo   C: Combination
# —————————————————————————————————————————————————
# AGE                                              
#   Mean      32.76       34.12          35.20     
# STRATA1</code></pre>
<p>does not show that the first row is derived from <code>AGE</code>. In
order to repeat content/label information, one should use the pagination
feature. Please read the related vignette.</p>
<p>Character indices are interpreted as paths (see below), NOT elements
to be matched against <code>names(tbl)</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>tbl[,<span class="fu">c</span>(<span class="st">&quot;ARM&quot;</span>, <span class="st">&quot;A: Drug X&quot;</span>)]</span></code></pre></div>
<pre><code>#             A: Drug X
# —————————————————————
# F                    
#   AGE                
#     Mean      32.76  
#   STRATA1            
#     A          21    
#     B          25    
#     C          33    
# M                    
#   AGE                
#     Mean      35.57  
#   STRATA1            
#     A          16    
#     B          21    
#     C          14</code></pre>
<div id="dealing-with-titles-foot-notes-and-top-left-information" class="section level3">
<h3>Dealing with titles, foot notes, and top left information</h3>
<p>As standard no additional information is kept after subsetting. Here,
we show with a more complete table how it is still possible to keep the
(possibly) relevant information.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">top_left</span>(tbl) <span class="ot">&lt;-</span> <span class="st">&quot;SEX&quot;</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">main_title</span>(tbl) <span class="ot">&lt;-</span> <span class="st">&quot;Table 1&quot;</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">subtitles</span>(tbl) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Authors:&quot;</span>, <span class="st">&quot; - Abcd Zabcd&quot;</span>, <span class="st">&quot; - Cde Zbcd&quot;</span>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="fu">main_footer</span>(tbl) <span class="ot">&lt;-</span> <span class="st">&quot;Please regard this table as an example of smart subsetting&quot;</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="fu">prov_footer</span>(tbl) <span class="ot">&lt;-</span> <span class="st">&quot;Do remember where you read this though&quot;</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="fu">fnotes_at_path</span>(tbl, <span class="at">rowpath =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;Mean&quot;</span>), </span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>               <span class="at">colpath =</span> <span class="fu">c</span>(<span class="st">&quot;ARM&quot;</span>, <span class="st">&quot;A: Drug X&quot;</span>)) <span class="ot">&lt;-</span> <span class="st">&quot;Very important mean&quot;</span></span></code></pre></div>
<p>Normal subsetting loses all the information showed above.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>tbl[<span class="dv">3</span>, <span class="dv">3</span>]</span></code></pre></div>
<pre><code>#        C: Combination
# —————————————————————
# Mean       35.20</code></pre>
<p>If all the rows are kept, top left information is also kept. This can
be also imposed by adding <code>keep_topleft = TRUE</code> to the
subsetting as follows:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>tbl[, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code># SEX         B: Placebo   C: Combination
# ———————————————————————————————————————
# F                                      
#   AGE                                  
#     Mean      34.12          35.20     
#   STRATA1                              
#     A           24             18      
#     B           27             21      
#     C           26             27      
# M                                      
#   AGE                                  
#     Mean      37.44          35.38     
#   STRATA1                              
#     A           19             20      
#     B           17             21      
#     C           19             19</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>tbl[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">3</span>, keep_topleft <span class="ot">=</span> <span class="cn">TRUE</span>]</span></code></pre></div>
<pre><code># SEX        C: Combination
# —————————————————————————
# F                        
#   AGE                    
#     Mean       35.20</code></pre>
<p>If the referenced entry is present in the subsetting, also the
referential footnote will appear. Please consider reading relevant
vignette about <a href="https://insightsengineering.github.io/rtables/main/articles/title_footer.html#referential-footnotes">referential
footnotes</a>. In case of subsetting, the referential footnotes are by
default indexed again, as if the produced table is a new one.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>tbl[<span class="dv">10</span>, <span class="dv">1</span>]</span></code></pre></div>
<pre><code>#        A: Drug X
# ————————————————
# Mean   35.57 {1}
# ————————————————
# 
# {1} - Very important mean
# ————————————————</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">col_paths_summary</span>(tbl) <span class="co"># Use these to find the right path to value or label</span></span></code></pre></div>
<pre><code># label             path               
# —————————————————————————————————————
# A: Drug X         ARM, A: Drug X     
# B: Placebo        ARM, B: Placebo    
# C: Combination    ARM, C: Combination</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">row_paths_summary</span>(tbl) <span class="co">#</span></span></code></pre></div>
<pre><code># rowname      node_class    path              
# —————————————————————————————————————————————
# F            LabelRow      SEX, F            
#   AGE        LabelRow      SEX, F, AGE       
#     Mean     DataRow       SEX, F, AGE, Mean 
#   STRATA1    LabelRow      SEX, F, STRATA1   
#     A        DataRow       SEX, F, STRATA1, A
#     B        DataRow       SEX, F, STRATA1, B
#     C        DataRow       SEX, F, STRATA1, C
# M            LabelRow      SEX, M            
#   AGE        LabelRow      SEX, M, AGE       
#     Mean     DataRow       SEX, M, AGE, Mean 
#   STRATA1    LabelRow      SEX, M, STRATA1   
#     A        DataRow       SEX, M, STRATA1, A
#     B        DataRow       SEX, M, STRATA1, B
#     C        DataRow       SEX, M, STRATA1, C</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># To select column value, use `NULL` for `rowpath`</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="fu">fnotes_at_path</span>(tbl, <span class="at">rowpath =</span> <span class="cn">NULL</span>, <span class="at">colpath =</span> <span class="fu">c</span>(<span class="st">&quot;ARM&quot;</span>, <span class="st">&quot;A: Drug X&quot;</span>)) <span class="ot">&lt;-</span> <span class="st">&quot;Interesting&quot;</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>tbl[<span class="dv">3</span>, <span class="dv">1</span>]</span></code></pre></div>
<pre><code>#        A: Drug X {1}
# ————————————————————
# Mean       32.76    
# ————————————————————
# 
# {1} - Interesting
# ————————————————————</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co"># reindexing of {2} as {1}</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="fu">fnotes_at_path</span>(tbl, <span class="at">rowpath =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;Mean&quot;</span>), </span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>               <span class="at">colpath =</span> <span class="cn">NULL</span>) <span class="ot">&lt;-</span> <span class="st">&quot;THIS mean&quot;</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>tbl <span class="co"># {1}, {2}, and {3} are present</span></span></code></pre></div>
<pre><code># Table 1
# Authors:
#  - Abcd Zabcd
#  - Cde Zbcd
# 
# ——————————————————————————————————————————————————————————
# SEX            A: Drug X {1}   B: Placebo   C: Combination
# ——————————————————————————————————————————————————————————
# F                                                         
#   AGE                                                     
#     Mean           32.76         34.12          35.20     
#   STRATA1                                                 
#     A               21             24             18      
#     B               25             27             21      
#     C               33             26             27      
# M                                                         
#   AGE                                                     
#     Mean {2}     35.57 {3}       37.44          35.38     
#   STRATA1                                                 
#     A               16             19             20      
#     B               21             17             21      
#     C               14             19             19      
# ——————————————————————————————————————————————————————————
# 
# {1} - Interesting
# {2} - THIS mean
# {3} - Very important mean
# ——————————————————————————————————————————————————————————
# 
# Please regard this table as an example of smart subsetting
# 
# Do remember where you read this though</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>tbl[<span class="dv">10</span>, <span class="dv">2</span>] <span class="co"># only {1} which was previously {2}</span></span></code></pre></div>
<pre><code>#            B: Placebo
# —————————————————————
# Mean {1}     37.44   
# —————————————————————
# 
# {1} - THIS mean
# —————————————————————</code></pre>
<p>Similar to what we have used to keep top left information, we can
specify to keep more information from the original table. As a standard
the foot notes are always present if the titles are kept.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>tbl[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, keep_titles <span class="ot">=</span> <span class="cn">TRUE</span>]</span></code></pre></div>
<pre><code># Table 1
# Authors:
#  - Abcd Zabcd
#  - Cde Zbcd
# 
# ——————————————————————————————————————
#            B: Placebo   C: Combination
# ——————————————————————————————————————
# F                                     
#   AGE                                 
#     Mean     34.12          35.20     
# ——————————————————————————————————————
# 
# Please regard this table as an example of smart subsetting
# 
# Do remember where you read this though</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>tbl[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, keep_titles <span class="ot">=</span> <span class="cn">FALSE</span>, keep_footers <span class="ot">=</span> <span class="cn">TRUE</span>]</span></code></pre></div>
<pre><code>#            B: Placebo   C: Combination
# ——————————————————————————————————————
# F                                     
#   AGE                                 
#     Mean     34.12          35.20     
# ——————————————————————————————————————
# 
# Please regard this table as an example of smart subsetting
# 
# Do remember where you read this though</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co"># Referential footnotes are not influenced by `keep_footers = FALSE`</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>tbl[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, keep_titles <span class="ot">=</span> <span class="cn">TRUE</span>, keep_footers <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code></pre></div>
<pre><code># Table 1
# Authors:
#  - Abcd Zabcd
#  - Cde Zbcd
# 
# ——————————————————————————————————————————————————————
#            A: Drug X {1}   B: Placebo   C: Combination
# ——————————————————————————————————————————————————————
# F                                                     
#   AGE                                                 
#     Mean       32.76         34.12          35.20     
# ——————————————————————————————————————————————————————
# 
# {1} - Interesting
# ——————————————————————————————————————————————————————</code></pre>
</div>
</div>
<div id="path-based-cell-value-accessing" class="section level2">
<h2>Path Based Cell Value Accessing:</h2>
<p>Tables can be subset or modified in a structurally aware manner via
<em>pathing</em>.</p>
<p>Paths define semantically meaningful positions within a constructed
table that correspond to the logic of the layout used to create it.</p>
<p>A path is an ordered set of split names, the names of subgroups
generated by the split, and the <code>@content</code> directive, which
steps into a position’s content (or row group summary) table.</p>
<p>We can see the row and column paths of an existing table via the
<code>row_paths()</code>, <code>col_paths()</code>,
<code>row_paths_summary()</code>, and <code>col_paths_summary()</code>,
functions, or as a portion of the more general
<code>make_row_df()</code> function output.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>lyt2 <span class="ot">&lt;-</span> <span class="fu">basic_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>    <span class="fu">split_cols_by</span>(<span class="st">&quot;ARM&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>    <span class="fu">split_cols_by</span>(<span class="st">&quot;SEX&quot;</span>, <span class="at">split_fun =</span> drop_split_levels) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>    <span class="fu">split_rows_by</span>(<span class="st">&quot;RACE&quot;</span>, <span class="at">split_fun =</span> drop_split_levels) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>    <span class="fu">summarize_row_groups</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>    <span class="fu">analyze</span>(<span class="fu">c</span>(<span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;STRATA1&quot;</span>)) </span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a>tbl2 <span class="ot">&lt;-</span> <span class="fu">build_table</span>(lyt2, ex_adsl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SEX <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a>                                             RACE <span class="sc">%in%</span> (<span class="fu">levels</span>(RACE)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])))</span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a>tbl2</span></code></pre></div>
<pre><code>#                                    A: Drug X                B: Placebo              C: Combination     
#                                 F            M            F            M            F            M     
# ———————————————————————————————————————————————————————————————————————————————————————————————————————
# ASIAN                       41 (53.9%)   25 (54.3%)   36 (52.2%)   30 (60.0%)   39 (60.9%)   32 (57.1%)
#   AGE                                                                                                  
#     Mean                      31.22        34.60        35.06        38.63        36.44        37.66   
#   STRATA1                                                                                              
#     A                           11           10           14           10           11           7     
#     B                           11           9            15           7            11           14    
#     C                           19           6            7            13           17           11    
# BLACK OR AFRICAN AMERICAN   18 (23.7%)   12 (26.1%)   16 (23.2%)   12 (24.0%)   14 (21.9%)   14 (25.0%)
#   AGE                                                                                                  
#     Mean                      34.06        34.58        33.88        36.33        33.21        34.21   
#   STRATA1                                                                                              
#     A                           5            2            5            6            3            7     
#     B                           6            5            3            4            4            4     
#     C                           7            5            8            2            7            3     
# WHITE                       17 (22.4%)   9 (19.6%)    17 (24.6%)   8 (16.0%)    11 (17.2%)   10 (17.9%)
#   AGE                                                                                                  
#     Mean                      34.12        40.00        32.41        34.62        33.00        30.80   
#   STRATA1                                                                                              
#     A                           5            3            3            3            3            5     
#     B                           5            4            8            4            5            2     
#     C                           7            2            6            1            3            3</code></pre>
<p>So the column paths are as follows:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="fu">col_paths_summary</span>(tbl2)</span></code></pre></div>
<pre><code># label             path                       
# —————————————————————————————————————————————
# A: Drug X         ARM, A: Drug X             
#   F               ARM, A: Drug X, SEX, F     
#   M               ARM, A: Drug X, SEX, M     
# B: Placebo        ARM, B: Placebo            
#   F               ARM, B: Placebo, SEX, F    
#   M               ARM, B: Placebo, SEX, M    
# C: Combination    ARM, C: Combination        
#   F               ARM, C: Combination, SEX, F
#   M               ARM, C: Combination, SEX, M</code></pre>
<p>and the row paths are as follows:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">row_paths_summary</span>(tbl2)</span></code></pre></div>
<pre><code># rowname                      node_class    path                                                                
# ———————————————————————————————————————————————————————————————————————————————————————————————————————————————
# ASIAN                        ContentRow    RACE, ASIAN, @content, ASIAN                                        
#   AGE                        LabelRow      RACE, ASIAN, AGE                                                    
#     Mean                     DataRow       RACE, ASIAN, AGE, Mean                                              
#   STRATA1                    LabelRow      RACE, ASIAN, STRATA1                                                
#     A                        DataRow       RACE, ASIAN, STRATA1, A                                             
#     B                        DataRow       RACE, ASIAN, STRATA1, B                                             
#     C                        DataRow       RACE, ASIAN, STRATA1, C                                             
# BLACK OR AFRICAN AMERICAN    ContentRow    RACE, BLACK OR AFRICAN AMERICAN, @content, BLACK OR AFRICAN AMERICAN
#   AGE                        LabelRow      RACE, BLACK OR AFRICAN AMERICAN, AGE                                
#     Mean                     DataRow       RACE, BLACK OR AFRICAN AMERICAN, AGE, Mean                          
#   STRATA1                    LabelRow      RACE, BLACK OR AFRICAN AMERICAN, STRATA1                            
#     A                        DataRow       RACE, BLACK OR AFRICAN AMERICAN, STRATA1, A                         
#     B                        DataRow       RACE, BLACK OR AFRICAN AMERICAN, STRATA1, B                         
#     C                        DataRow       RACE, BLACK OR AFRICAN AMERICAN, STRATA1, C                         
# WHITE                        ContentRow    RACE, WHITE, @content, WHITE                                        
#   AGE                        LabelRow      RACE, WHITE, AGE                                                    
#     Mean                     DataRow       RACE, WHITE, AGE, Mean                                              
#   STRATA1                    LabelRow      RACE, WHITE, STRATA1                                                
#     A                        DataRow       RACE, WHITE, STRATA1, A                                             
#     B                        DataRow       RACE, WHITE, STRATA1, B                                             
#     C                        DataRow       RACE, WHITE, STRATA1, C</code></pre>
<p>To get a semantically meaningful subset of our table, then, we can
use <code>[</code> (or <code>tt_at_path()</code> which underlies it)</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>tbl2[<span class="fu">c</span>(<span class="st">&quot;RACE&quot;</span>, <span class="st">&quot;ASIAN&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;ARM&quot;</span>, <span class="st">&quot;C: Combination&quot;</span>)]</span></code></pre></div>
<pre><code>#                 C: Combination     
#                 F            M     
# ———————————————————————————————————
# ASIAN       39 (60.9%)   32 (57.1%)
#   AGE                              
#     Mean      36.44        37.66   
#   STRATA1                          
#     A           11           7     
#     B           11           14    
#     C           17           11</code></pre>
<p>We can also retrieve individual cell-values via the
<code>value_at()</code> convenience function, which takes a pair of row
and column paths which resolve together to an individual cell,
e.g. average age for Asian female patients in arm A:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="fu">value_at</span>(tbl2, <span class="fu">c</span>(<span class="st">&quot;RACE&quot;</span>, <span class="st">&quot;ASIAN&quot;</span>, <span class="st">&quot;AGE&quot;</span>,  <span class="st">&quot;Mean&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;ARM&quot;</span>, <span class="st">&quot;A: Drug X&quot;</span>, <span class="st">&quot;SEX&quot;</span>, <span class="st">&quot;F&quot;</span>))</span></code></pre></div>
<pre><code># [1] 31.21951</code></pre>
<p>You can also request information from non-cell specific paths with
the <code>cell_values()</code> function:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="fu">cell_values</span>(tbl2, <span class="fu">c</span>(<span class="st">&quot;RACE&quot;</span>, <span class="st">&quot;ASIAN&quot;</span>, <span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;Mean&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;ARM&quot;</span>, <span class="st">&quot;A: Drug X&quot;</span>))</span></code></pre></div>
<pre><code># $`A: Drug X.F`
# [1] 31.21951
# 
# $`A: Drug X.M`
# [1] 34.6</code></pre>
<p>Note the return value of <code>cell_values()</code> is always a list
even if you specify a path to a cell:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="fu">cell_values</span>(tbl2, <span class="fu">c</span>(<span class="st">&quot;RACE&quot;</span>, <span class="st">&quot;ASIAN&quot;</span>, <span class="st">&quot;AGE&quot;</span>,  <span class="st">&quot;Mean&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;ARM&quot;</span>, <span class="st">&quot;A: Drug X&quot;</span>, <span class="st">&quot;SEX&quot;</span>, <span class="st">&quot;F&quot;</span>))</span></code></pre></div>
<pre><code># $`A: Drug X.F`
# [1] 31.21951</code></pre>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
