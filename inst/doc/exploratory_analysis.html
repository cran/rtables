<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Jana Stoilova, Adrian Waddell and Gabriel Becker" />

<meta name="date" content="2024-04-15" />

<title>Exploratory Analysis</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Exploratory Analysis</h1>
<h4 class="author">Jana Stoilova, Adrian Waddell and Gabriel Becker</h4>
<h4 class="date">2024-04-15</h4>



<style type="text/css">
.reveal .r code {
white-space: pre;
}
</style>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>In this vignette, we would like to introduce how
<code>qtable()</code> can be used to easily create cross tabulations for
exploratory data analysis. <code>qtable()</code> is an extension of
<code>table()</code> from base R and can do much beyond creating two-way
contingency tables. The function has a simple to use interface while
internally it builds layouts using the <code>rtables</code>
framework.</p>
</div>
<div id="getting-started" class="section level2">
<h2>Getting Started</h2>
<p>Load packages used in this vignette:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(rtables)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>Let’s start by seeing what <code>table()</code> can do:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">table</span>(ex_adsl<span class="sc">$</span>ARM)</span></code></pre></div>
<pre><code># 
#      A: Drug X     B: Placebo C: Combination 
#            134            134            132</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">table</span>(ex_adsl<span class="sc">$</span>SEX, ex_adsl<span class="sc">$</span>ARM)</span></code></pre></div>
<pre><code>#                   
#                    A: Drug X B: Placebo C: Combination
#   F                       79         77             66
#   M                       51         55             60
#   U                        3          2              4
#   UNDIFFERENTIATED         1          0              2</code></pre>
<p>We can easily recreate the cross-tables above with
<code>qtable()</code> by specifying a data.frame with variable(s) to
tabulate. The <code>col_vars</code> and <code>row_vars</code> arguments
control how to split the data across columns and rows respectively.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">qtable</span>(ex_adsl, <span class="at">col_vars =</span> <span class="st">&quot;ARM&quot;</span>)</span></code></pre></div>
<pre><code>#         A: Drug X   B: Placebo   C: Combination
#          (N=134)     (N=134)        (N=132)    
# ———————————————————————————————————————————————
# count      134         134            132</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">qtable</span>(ex_adsl, <span class="at">col_vars =</span> <span class="st">&quot;ARM&quot;</span>, <span class="at">row_vars =</span> <span class="st">&quot;SEX&quot;</span>)</span></code></pre></div>
<pre><code>#                    A: Drug X   B: Placebo   C: Combination
# count               (N=134)     (N=134)        (N=132)    
# ——————————————————————————————————————————————————————————
# F                     79           77             66      
# M                     51           55             60      
# U                      3           2              4       
# UNDIFFERENTIATED       1           0              2</code></pre>
<p>Aside from the display style, the main difference is that
<code>qtable()</code> will add (N=xx) in the table header by default.
This can be removed with <code>show_colcounts</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">qtable</span>(ex_adsl, <span class="st">&quot;ARM&quot;</span>, <span class="at">show_colcounts =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code># count            all obs
# ————————————————————————
# A: Drug X          134  
# B: Placebo         134  
# C: Combination     132</code></pre>
<p>Any variables used as the row or column facets should not have any
empty strings (““). This is because non empty values are required as
labels when generating the table. The code below will generate an
error.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>tmp_adsl <span class="ot">&lt;-</span> ex_adsl</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>tmp_adsl<span class="sc">$</span>new <span class="ot">&lt;-</span> <span class="fu">rep_len</span>(<span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="fu">nrow</span>(tmp_adsl))</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="fu">qtable</span>(tmp_adsl, <span class="at">row_vars =</span> <span class="st">&quot;new&quot;</span>)</span></code></pre></div>
</div>
<div id="nested-tables" class="section level2">
<h2>Nested Tables</h2>
<p>Providing more than one variable name for the row or column structure
in <code>qtable()</code> will create a nested table. Arbitrary nesting
is supported in each dimension.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">qtable</span>(ex_adsl, <span class="at">row_vars =</span> <span class="fu">c</span>(<span class="st">&quot;SEX&quot;</span>, <span class="st">&quot;STRATA1&quot;</span>), <span class="at">col_vars =</span> <span class="fu">c</span>(<span class="st">&quot;ARM&quot;</span>, <span class="st">&quot;STRATA2&quot;</span>))</span></code></pre></div>
<pre><code>#                       A: Drug X        B: Placebo       C: Combination  
#                      S1       S2       S1       S2       S1        S2   
# count              (N=73)   (N=61)   (N=67)   (N=67)   (N=56)    (N=76) 
# ————————————————————————————————————————————————————————————————————————
# F                                                                       
#   A                  12       9        11       13        7        11   
#   B                  14       11       12       15        9        12   
#   C                  17       16       13       13       14        13   
# M                                                                       
#   A                  5        11       10       9         6        14   
#   B                  13       8        7        10        9        12   
#   C                  8        6        13       6         8        11   
# U                                                                       
#   A                  1        0        1        0         1         0   
#   B                  1        0        0        1         0         1   
#   C                  1        0        0        0         1         1   
# UNDIFFERENTIATED                                                        
#   A                  0        0        0        0         0         1   
#   C                  1        0        0        0         1         0</code></pre>
<p>Note that by default, unobserved factor levels within a facet are not
included in the table. This can be modified with
<code>drop_levels</code>. The code below adds a row of 0s for
<code>STRATA1</code> level “B” nested under the <code>SEX</code> level
“UNDIFFERENTIATED”.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">qtable</span>(</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  ex_adsl,</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="at">row_vars =</span> <span class="fu">c</span>(<span class="st">&quot;SEX&quot;</span>, <span class="st">&quot;STRATA1&quot;</span>),</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="at">col_vars =</span> <span class="fu">c</span>(<span class="st">&quot;ARM&quot;</span>, <span class="st">&quot;STRATA2&quot;</span>),</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="at">drop_levels =</span> <span class="cn">FALSE</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#                       A: Drug X        B: Placebo       C: Combination  
#                      S1       S2       S1       S2       S1        S2   
# count              (N=73)   (N=61)   (N=67)   (N=67)   (N=56)    (N=76) 
# ————————————————————————————————————————————————————————————————————————
# F                                                                       
#   A                  12       9        11       13        7        11   
#   B                  14       11       12       15        9        12   
#   C                  17       16       13       13       14        13   
# M                                                                       
#   A                  5        11       10       9         6        14   
#   B                  13       8        7        10        9        12   
#   C                  8        6        13       6         8        11   
# U                                                                       
#   A                  1        0        1        0         1         0   
#   B                  1        0        0        1         0         1   
#   C                  1        0        0        0         1         1   
# UNDIFFERENTIATED                                                        
#   A                  0        0        0        0         0         1   
#   B                  0        0        0        0         0         0   
#   C                  1        0        0        0         1         0</code></pre>
<p>In contrast, <code>table()</code> cannot return a nested table.
Rather it produces a list of contingency tables when more than two
variables are used as inputs.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">table</span>(ex_adsl<span class="sc">$</span>SEX, ex_adsl<span class="sc">$</span>STRATA1, ex_adsl<span class="sc">$</span>ARM, ex_adsl<span class="sc">$</span>STRATA2)</span></code></pre></div>
<pre><code># , ,  = A: Drug X,  = S1
# 
#                   
#                     A  B  C
#   F                12 14 17
#   M                 5 13  8
#   U                 1  1  1
#   UNDIFFERENTIATED  0  0  1
# 
# , ,  = B: Placebo,  = S1
# 
#                   
#                     A  B  C
#   F                11 12 13
#   M                10  7 13
#   U                 1  0  0
#   UNDIFFERENTIATED  0  0  0
# 
# , ,  = C: Combination,  = S1
# 
#                   
#                     A  B  C
#   F                 7  9 14
#   M                 6  9  8
#   U                 1  0  1
#   UNDIFFERENTIATED  0  0  1
# 
# , ,  = A: Drug X,  = S2
# 
#                   
#                     A  B  C
#   F                 9 11 16
#   M                11  8  6
#   U                 0  0  0
#   UNDIFFERENTIATED  0  0  0
# 
# , ,  = B: Placebo,  = S2
# 
#                   
#                     A  B  C
#   F                13 15 13
#   M                 9 10  6
#   U                 0  1  0
#   UNDIFFERENTIATED  0  0  0
# 
# , ,  = C: Combination,  = S2
# 
#                   
#                     A  B  C
#   F                11 12 13
#   M                14 12 11
#   U                 0  1  1
#   UNDIFFERENTIATED  1  0  0</code></pre>
<p>With some help from <code>stats::ftable()</code> the nested structure
can be achieved in two steps.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">ftable</span>(ex_adsl[, <span class="fu">c</span>(<span class="st">&quot;SEX&quot;</span>, <span class="st">&quot;STRATA1&quot;</span>, <span class="st">&quot;ARM&quot;</span>, <span class="st">&quot;STRATA2&quot;</span>)])</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">ftable</span>(t1, <span class="at">row.vars =</span> <span class="fu">c</span>(<span class="st">&quot;SEX&quot;</span>, <span class="st">&quot;STRATA1&quot;</span>))</span></code></pre></div>
<pre><code>#                          ARM     A: Drug X    B: Placebo    C: Combination   
#                          STRATA2        S1 S2         S1 S2             S1 S2
# SEX              STRATA1                                                     
# F                A                      12  9         11 13              7 11
#                  B                      14 11         12 15              9 12
#                  C                      17 16         13 13             14 13
# M                A                       5 11         10  9              6 14
#                  B                      13  8          7 10              9 12
#                  C                       8  6         13  6              8 11
# U                A                       1  0          1  0              1  0
#                  B                       1  0          0  1              0  1
#                  C                       1  0          0  0              1  1
# UNDIFFERENTIATED A                       0  0          0  0              0  1
#                  B                       0  0          0  0              0  0
#                  C                       1  0          0  0              1  0</code></pre>
</div>
<div id="na-values" class="section level2">
<h2>NA Values</h2>
<p>So far in all the examples we have seen, we used counts to summarize
the data in each table cell as this is the default analysis used by
<code>qtable()</code>. Internally, a single analysis variable specified
by <code>avar</code> is used to generate the counts in the table. The
default analysis variable is the first variable in <code>data</code>. In
the case of <code>ex_adsl</code> this is “STUDYID”.</p>
<p>Let’s see what happens when we introduce some <code>NA</code> values
into the analysis variable:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>tmp_adsl <span class="ot">&lt;-</span> ex_adsl</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>tmp_adsl[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="cn">NA_character_</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="fu">qtable</span>(tmp_adsl, <span class="at">row_vars =</span> <span class="st">&quot;ARM&quot;</span>, <span class="at">col_vars =</span> <span class="st">&quot;SEX&quot;</span>)</span></code></pre></div>
<pre><code>#                     F         M        U     UNDIFFERENTIATED
# count            (N=222)   (N=166)   (N=9)        (N=3)      
# —————————————————————————————————————————————————————————————
# A: Drug X           0         0        0            0        
# B: Placebo          0         0        0            0        
# C: Combination      0         0        0            0</code></pre>
<p>The resulting table is showing 0’s across all cells because all the
values of the analysis variable are <code>NA</code>.</p>
<p>Keep this behavior in mind when doing quick exploratory analysis
using the default counts aggregate function of <code>qtable</code>.</p>
<p>If this does not suit your purpose, you can either pre-process your
data to re-code the <code>NA</code> values or use another analysis
function. We will see how the latter is done in the <a href="#custom-aggregation">Custom Aggregation</a> section.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># Recode NA values</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>tmp_adsl[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">addNA</span>(tmp_adsl[[<span class="dv">1</span>]])</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="fu">qtable</span>(tmp_adsl, <span class="at">row_vars =</span> <span class="st">&quot;ARM&quot;</span>, <span class="at">col_vars =</span> <span class="st">&quot;SEX&quot;</span>)</span></code></pre></div>
<pre><code>#                     F         M        U     UNDIFFERENTIATED
# count            (N=222)   (N=166)   (N=9)        (N=3)      
# —————————————————————————————————————————————————————————————
# A: Drug X          79        51        3            1        
# B: Placebo         77        55        2            0        
# C: Combination     66        60        4            2</code></pre>
<p>In addition, row and column variables should have <code>NA</code>
levels explicitly labelled as above. If this is not done, the columns
and/or rows will not reflect the full data.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>tmp_adsl<span class="sc">$</span>new1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="cn">NA_character_</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;Z&quot;</span>))</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="fu">qtable</span>(tmp_adsl, <span class="at">row_vars =</span> <span class="st">&quot;ARM&quot;</span>, <span class="at">col_vars =</span> <span class="st">&quot;new1&quot;</span>)</span></code></pre></div>
<pre><code>#                    X       Y       Z  
# count            (N=0)   (N=0)   (N=0)
# ——————————————————————————————————————
# A: Drug X          0       0       0  
# B: Placebo         0       0       0  
# C: Combination     0       0       0</code></pre>
<p>Explicitly labeling the <code>NA</code> levels in the column facet
adds a column to the table:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>tmp_adsl<span class="sc">$</span>new2 <span class="ot">&lt;-</span> <span class="fu">addNA</span>(tmp_adsl<span class="sc">$</span>new1)</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="fu">levels</span>(tmp_adsl<span class="sc">$</span>new2)[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&lt;NA&gt;&quot;</span> <span class="co"># NA needs to be a recognizible string</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="fu">qtable</span>(tmp_adsl, <span class="at">row_vars =</span> <span class="st">&quot;ARM&quot;</span>, <span class="at">col_vars =</span> <span class="st">&quot;new2&quot;</span>)</span></code></pre></div>
<pre><code>#                    X       Y       Z      &lt;NA&gt;  
# count            (N=0)   (N=0)   (N=0)   (N=400)
# ————————————————————————————————————————————————
# A: Drug X          0       0       0       134  
# B: Placebo         0       0       0       134  
# C: Combination     0       0       0       132</code></pre>
</div>
<div id="custom-aggregation" class="section level2">
<h2>Custom Aggregation</h2>
<p>A powerful feature of <code>qtable()</code> is that the user can
define the type of function used to summarize the data in each facet. We
can specify the type of analysis summary using the <code>afun</code>
argument:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">qtable</span>(ex_adsl, <span class="at">row_vars =</span> <span class="st">&quot;STRATA2&quot;</span>, <span class="at">col_vars =</span> <span class="st">&quot;ARM&quot;</span>, <span class="at">avar =</span> <span class="st">&quot;AGE&quot;</span>, <span class="at">afun =</span> mean)</span></code></pre></div>
<pre><code>#              A: Drug X   B: Placebo   C: Combination
# AGE - mean    (N=134)     (N=134)        (N=132)    
# ————————————————————————————————————————————————————
# S1             34.10       36.46          35.70     
# S2             33.38       34.40          35.24</code></pre>
<p>Note that the analysis variable <code>AGE</code> and analysis
function name are included in the top right header of the table.</p>
<p>If the analysis function returns a vector of 2 or 3 elements, the
result is displayed in multi-valued single cells.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">qtable</span>(ex_adsl, <span class="at">row_vars =</span> <span class="st">&quot;STRATA2&quot;</span>, <span class="at">col_vars =</span> <span class="st">&quot;ARM&quot;</span>, <span class="at">avar =</span> <span class="st">&quot;AGE&quot;</span>, <span class="at">afun =</span> range)</span></code></pre></div>
<pre><code>#                A: Drug X    B: Placebo    C: Combination
# AGE - range     (N=134)       (N=134)        (N=132)    
# ————————————————————————————————————————————————————————
# S1            23.0 / 48.0   24.0 / 62.0    20.0 / 69.0  
# S2            21.0 / 50.0   21.0 / 58.0    23.0 / 64.0</code></pre>
<p>If you want to use an analysis function with more than 3 summary
elements, you can use a list. In this case, the values are displayed in
the table as multiple stacked cells within each facet. If the list
elements are named, the names are used as row labels.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>fivenum2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">as.list</span>(<span class="fu">fivenum</span>(x)), <span class="fu">c</span>(<span class="st">&quot;min&quot;</span>, <span class="st">&quot;Q1&quot;</span>, <span class="st">&quot;MED&quot;</span>, <span class="st">&quot;Q3&quot;</span>, <span class="st">&quot;max&quot;</span>))</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>}</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="fu">qtable</span>(ex_adsl, <span class="at">row_vars =</span> <span class="st">&quot;STRATA2&quot;</span>, <span class="at">col_vars =</span> <span class="st">&quot;ARM&quot;</span>, <span class="at">avar =</span> <span class="st">&quot;AGE&quot;</span>, <span class="at">afun =</span> fivenum2)</span></code></pre></div>
<pre><code>#                  A: Drug X   B: Placebo   C: Combination
# AGE - fivenum2    (N=134)     (N=134)        (N=132)    
# ————————————————————————————————————————————————————————
# S1                                                      
#   min              23.00       24.00          20.00     
#   Q1               28.00       30.00          30.50     
#   MED              34.00       36.00          35.00     
#   Q3               39.00       40.50          40.00     
#   max              48.00       62.00          69.00     
# S2                                                      
#   min              21.00       21.00          23.00     
#   Q1               29.00       29.50          30.00     
#   MED              32.00       32.00          34.50     
#   Q3               38.00       39.50          38.00     
#   max              50.00       58.00          64.00</code></pre>
<p>More advanced formatting can be controlled with
<code>in_rows()</code>. See function documentation for more details.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>meansd_range <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>  <span class="fu">in_rows</span>(</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>    <span class="st">&quot;Mean (sd)&quot;</span> <span class="ot">=</span> <span class="fu">rcell</span>(<span class="fu">c</span>(<span class="fu">mean</span>(x), <span class="fu">sd</span>(x)), <span class="at">format =</span> <span class="st">&quot;xx.xx (xx.xx)&quot;</span>),</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>    <span class="st">&quot;Range&quot;</span> <span class="ot">=</span> <span class="fu">rcell</span>(<span class="fu">range</span>(x), <span class="at">format =</span> <span class="st">&quot;xx - xx&quot;</span>)</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>  )</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>}</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a><span class="fu">qtable</span>(ex_adsl, <span class="at">row_vars =</span> <span class="st">&quot;STRATA2&quot;</span>, <span class="at">col_vars =</span> <span class="st">&quot;ARM&quot;</span>, <span class="at">avar =</span> <span class="st">&quot;AGE&quot;</span>, <span class="at">afun =</span> meansd_range)</span></code></pre></div>
<pre><code>#                       A: Drug X      B: Placebo    C: Combination
# AGE - meansd_range     (N=134)        (N=134)         (N=132)    
# —————————————————————————————————————————————————————————————————
# S1                                                               
#   Mean (sd)          34.10 (6.71)   36.46 (7.72)    35.70 (8.22) 
#   Range                23 - 48        24 - 62         20 - 69    
# S2                                                               
#   Mean (sd)          33.38 (6.40)   34.40 (7.99)    35.24 (7.39) 
#   Range                21 - 50        21 - 58         23 - 64</code></pre>
</div>
<div id="marginal-summaries" class="section level2">
<h2>Marginal Summaries</h2>
<p>Another feature of <code>qtable()</code> is the ability to quickly
add marginal summary rows with the <code>summarize_groups</code>
argument. This summary will add to the table the count of non-NA records
of the analysis variable at each level of nesting. For example, compare
these two tables:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="fu">qtable</span>(</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>  ex_adsl,</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>  <span class="at">row_vars =</span> <span class="fu">c</span>(<span class="st">&quot;STRATA1&quot;</span>, <span class="st">&quot;STRATA2&quot;</span>), <span class="at">col_vars =</span> <span class="st">&quot;ARM&quot;</span>,</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>  <span class="at">avar =</span> <span class="st">&quot;AGE&quot;</span>, <span class="at">afun =</span> mean</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#              A: Drug X   B: Placebo   C: Combination
# AGE - mean    (N=134)     (N=134)        (N=132)    
# ————————————————————————————————————————————————————
# A                                                   
#   S1           31.61       36.68          34.00     
#   S2           34.40       33.55          34.35     
# B                                                   
#   S1           34.57       37.68          35.83     
#   S2           32.79       34.77          36.68     
# C                                                   
#   S1           35.26       35.38          36.58     
#   S2           32.95       34.89          34.72</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">qtable</span>(</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>  ex_adsl,</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>  <span class="at">row_vars =</span> <span class="fu">c</span>(<span class="st">&quot;STRATA1&quot;</span>, <span class="st">&quot;STRATA2&quot;</span>), <span class="at">col_vars =</span> <span class="st">&quot;ARM&quot;</span>,</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a>  <span class="at">summarize_groups =</span> <span class="cn">TRUE</span>, <span class="at">avar =</span> <span class="st">&quot;AGE&quot;</span>, <span class="at">afun =</span> mean</span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#                  A: Drug X    B: Placebo   C: Combination
# AGE - mean        (N=134)      (N=134)        (N=132)    
# —————————————————————————————————————————————————————————
# A                38 (28.4%)   44 (32.8%)     40 (30.3%)  
#   S1             18 (13.4%)   22 (16.4%)     14 (10.6%)  
#     AGE - mean     31.61        36.68          34.00     
#   S2             20 (14.9%)   22 (16.4%)     26 (19.7%)  
#     AGE - mean     34.40        33.55          34.35     
# B                47 (35.1%)   45 (33.6%)     43 (32.6%)  
#   S1             28 (20.9%)   19 (14.2%)     18 (13.6%)  
#     AGE - mean     34.57        37.68          35.83     
#   S2             19 (14.2%)   26 (19.4%)     25 (18.9%)  
#     AGE - mean     32.79        34.77          36.68     
# C                49 (36.6%)   45 (33.6%)     49 (37.1%)  
#   S1             27 (20.1%)   26 (19.4%)     24 (18.2%)  
#     AGE - mean     35.26        35.38          36.58     
#   S2             22 (16.4%)   19 (14.2%)     25 (18.9%)  
#     AGE - mean     32.95        34.89          34.72</code></pre>
<p>In the second table, there are marginal summary rows for each level
of the two row facet variables: <code>STRATA1</code> and
<code>STRATA2</code>. The number 18 in the second row gives the count of
observations part of <code>ARM</code> level “A: Drug X”,
<code>STRATA1</code> level “A”, and <code>STRATA2</code> level “S1”. The
percent is calculated as the cell count divided by the column count
given in the table header. So we can see that the mean <code>AGE</code>
of 31.61 in that subgroup is based on 18 subjects which correspond to
13.4% of the subjects in arm “A: Drug X”.</p>
<p>See <code>?summarize_row_groups</code> for how to add marginal
summary rows when using the core <code>rtables</code> framework.</p>
</div>
<div id="table-decorations" class="section level2">
<h2>Table Decorations</h2>
<p>Tables generated with <code>qtable()</code> can include annotations
such as titles, subtitles and footnotes like so:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">qtable</span>(</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>  ex_adsl,</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>  <span class="at">row_vars =</span> <span class="st">&quot;STRATA2&quot;</span>, <span class="at">col_vars =</span> <span class="st">&quot;ARM&quot;</span>,</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Strata 2 Summary&quot;</span>,</span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;STUDY &quot;</span>, ex_adsl<span class="sc">$</span>STUDYID[<span class="dv">1</span>]),</span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>  <span class="at">main_footer =</span> <span class="fu">paste0</span>(<span class="st">&quot;Date: &quot;</span>, <span class="fu">as.character</span>(<span class="fu">Sys.Date</span>()))</span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>)</span></code></pre></div>
<pre><code># Strata 2 Summary
# STUDY AB12345
# 
# ———————————————————————————————————————————————
#         A: Drug X   B: Placebo   C: Combination
# count    (N=134)     (N=134)        (N=132)    
# ———————————————————————————————————————————————
# S1         73           67             56      
# S2         61           67             76      
# ———————————————————————————————————————————————
# 
# Date: 2024-04-15</code></pre>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>Here is what we have learned in this vignette:</p>
<ul>
<li><p><code>qtable()</code> can replace and extend uses of
<code>table()</code> and <code>stats::ftable()</code></p></li>
<li><p><code>qtable()</code> is useful for exploratory data
analysis</p></li>
</ul>
<p>As the intended use of <code>qtable()</code> is for exploratory data
analysis, there is limited functionality for building very complex
tables. For details on how to get started with the core
<code>rtables</code> layout functionality see the <a href="https://insightsengineering.github.io/rtables/main/articles/introduction.html"><code>introduction</code></a>
vignette.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
